import"./hoisted.DOw85ys1.js";import{$ as i}from"./store.8pX9dcuw.js";import{d as y}from"./player.C9XHYsCf.js";const I=Array.from(document.querySelectorAll(".av-file"));i.listen((a,t,o)=>{if(!o||!a[o])return null;I.filter(s=>s.getAttribute("data-player-id")===o).forEach(s=>{const r=s.getAttribute("data-file-id");a[o].avFileUuid===r?s.classList.remove("hidden"):s.classList.add("hidden")})});const v=a=>{a.classList.add("hidden"),a.classList.remove("flex")},h=a=>{a.classList.add("flex"),a.classList.remove("hidden")},m="!bg-blue-hover",b=document.querySelectorAll(".playAnnotation");for(let a=0;a<b.length;a++){const t=b[a];if(t.dataset.start&&t.dataset.playerId){const o=i.get()[t.dataset.playerId]?.annotationStarts;o&&(o.push({start:Math.floor(Number(t.dataset.start)),end:Math.floor(Number(t.dataset.end))>Math.floor(Number(t.dataset.start))?Math.floor(Number(t.dataset.end)):void 0,playerId:t.dataset.playerId}),i.setKey(t.dataset.playerId,{...i.get()[t.dataset.playerId]||y,annotationStarts:o})),t.addEventListener("click",()=>{const s=t.dataset.playerId||"null";i.setKey(s,{...i.get()[s]||y,position:Number(t.dataset.start),seekTo:Number(t.dataset.start),isPlaying:!0})})}}i.listen((a,t,o)=>{if(!o)return null;const s=o.split(".")[0],r=a[s],l=document.querySelector(`.eventContainer[data-player-id="${s}"]`);if(!l)return console.error(`No event container found for ${o}`),null;const d=l.querySelectorAll(".annotationNode"),c=l.querySelectorAll(".annotationTags"),f=r.annotationStarts?.filter(e=>e.playerId===o),u=f?.findIndex((e,n)=>typeof e.end=="number"?e.start<=r.position&&e.end>r.position:n<f.length-1?e.start<=r.position&&f[n+1].start>r.position:e.start<=r.position);if(typeof u=="number"&&u>=0){const e=d[u];if(e){if(r.autoScroll)if(r.isEmbed){const n=document.querySelector(`.videoAnnotationContainer[data-player-id="${o}"]`),p=e.offsetTop;n?n.scroll({top:p-n.clientHeight,behavior:"smooth"}):l.scroll({top:p-l.clientHeight/3,behavior:"smooth"})}else e.scrollIntoView({behavior:"smooth",block:"end"});e.classList.add(m)}for(let n=0;n<d.length;n++)n!==u&&d[n].classList.remove(m)}if(r.showTags!==t[s]?.showTags)if(r.showTags)for(let e=0;e<c.length;e++)h(c[e]);else for(let e=0;e<c.length;e++)v(c[e]);for(const e of d){const n=e.getAttribute("data-uuid");n&&r.filteredAnnotations.includes(n)?h(e):v(e)}});const g=document.querySelectorAll(".event-detail-tab-button");g.forEach(a=>{const t=a.id.replace("av-tab-",""),o=a.getAttribute("data-player-id");a.addEventListener("click",()=>{i.setKey(`${o}.avFileUuid`,t)})});i.listen(a=>{if(!a)return null;g.forEach(t=>{const o=t.id.replace("av-tab-",""),s=t.getAttribute("data-player-id");i.get()[s].avFileUuid===o?t.classList.add("event-detail-selected-tab"):t.classList.remove("event-detail-selected-tab")})});
